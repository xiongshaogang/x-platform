<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xplatform.base.work.schedule.mybatis.dao.ReminderMybatisDao">
	<resultMap id="Message" type="Map">
		<id column="id" property="id" />
		<result column="is_read" property="isRead" />
		<result column="create_time" property="createTime" />
		<result column="createTime" property="createTime" />
		<result column="title" property="title" />
		<result column="context" property="context" />
		<result column="start_date" property="startDate" />
		<result column="end_date" property="endDate" />
		<result column="tid" property="tid" />
		<result column="is_read" property="isRead" />
		<result column="name" property="name" />
		<result column="title" property="title" />
		<result column="meeting_person" property="meetingPerson" />
		<result column="meeting_place" property="meetingPlace" />
		<result column="meeting_time" property="meetingTime" />
		<result column="train_person" property="trainPerson" />
		<result column="train_place" property="trainPlace" />
		<result column="train_time" property="trainTime" />
		<result column="need_reply" property="needReply" />
		<result column="needReply" property="needReply" />
		<result column="reply_content" property="replyContent" />
		<result column="sid" property="sid" />
		<result column="mid" property="mid" />
		<result column="opinion" property="opinion" />
		<result column="exe_user_id" property="exe_user_id" />
		<result column="update_time" property="update_time" />
	</resultMap>
	<!-- parameterType传入参数类型，resultType返回参数类型 -->
	<select id="queryDateReminderList" resultMap="Message"
		resultType="Map" parameterType="Map">
		select
		    tr.id,
		    tr.is_read,
		    tr.create_time,
		    tws.title,
		    tws.context,
		    tws.start_date,
		    tws.end_date,
		    tws.id as tid
		from t_sys_message_receive tr
		left join t_sys_message_send ts
		on tr.send_id = ts.ID
		left join t_work_schedule tws
		on tws.ID = ts.type_id
		where 
		tws.user_id = #{userId} 
		and ts.message_type= #{messageType}
		order by tr.create_time desc
	</select>
	
	<!-- 获取会议通知提醒列表 -->
	<select id="queryMeetingInform" resultMap="Message"
		resultType="Map" parameterType="Map">
		SELECT  tr.id ,ts.id as sid ,tm.id as mid, tr.is_read,tm.name,tm.title,tm.meeting_person,tm.meeting_place,tm.meeting_time,tm.need_reply as needReply,tr.create_time as createTime
		 from t_sys_message_receive tr 
         left join t_sys_message_send ts on tr.send_id = ts.ID
         left join t_sys_message_meeting tm on ts.type_id = tm.ID
         left join t_org_user u on u.user_type_id = tr.receive_id
         where u.id = #{userId} and ts.message_type=#{messageType} and tr.status = '1'
         <if test="name !=null and name!=''">
         and tm.name like "%"#{name}"%"
         </if>
         <if test="sort !=null and sort !=''">
		order by ${sort} ${order}
		</if>
	</select>
	
	<!-- 获取培训通知提醒列表 -->
	<select id="queryTrainInform" resultMap="Message"
		resultType="Map" parameterType="Map">
		SELECT  tr.id ,ts.id as sid ,tt.id as mid, tr.is_read,tt.name,tt.title,tt.train_person,tt.train_place,tt.train_time,tt.need_reply as needReply,tr.create_time as createTime
		 from t_sys_message_receive tr 
         left join t_sys_message_send ts on tr.send_id = ts.ID
         left join t_sys_message_train tt on ts.type_id = tt.ID
         left join t_org_user u on u.user_type_id = tr.receive_id
         where u.id = #{userId} and ts.message_type=#{messageType} and tr.status = '1'
         <if test="name !=null and name!=''">
         and tt.name like "%"#{name}"%"
         </if>
         <if test="sort !=null and sort !=''">
		order by ${sort} ${order}
		</if>
	</select>
	
	<!-- 获取内部通告提醒列表 -->
	<select id="queryAnnunciateInform" resultMap="Message"
		resultType="Map" parameterType="Map">
		SELECT  tr.id ,ts.id as sid ,ta.id as mid, tr.is_read,ta.name,ta.title,ta.need_reply as needReply,tr.create_time as createTime
		 from t_sys_message_receive tr 
         left join t_sys_message_send ts on tr.send_id = ts.ID
         left join t_sys_message_annunciate ta on ts.type_id = ta.ID
         left join t_org_user u on u.user_type_id = tr.receive_id
         where u.id = #{userId} and ts.message_type=#{messageType} and tr.status = '1'
         <if test="name !=null and name!=''">
         and ta.name like "%"#{name}"%"
         </if>
        <if test="sort !=null and sort !=''">
		order by ${sort} ${order}
		</if>
	</select>
	
	<!-- 获取内部通告审核意见-->
	<select id="queryAnnApprove" resultMap="Message"
		resultType="Map" parameterType="Map">
		select o.opinion,o.update_time
		from t_flow_instance_history t  
		left join t_flow_task_opinion o 
		on t.act_id = o.act_id and t.act_inst_id = o.act_instance_id
		 where o.check_status ='1' and t.business_key=#{id} and o.task_key=#{taskId}
		 order by o.update_time desc
	</select>
</mapper>